<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Simple design: probably a good one! | adonese&#39;s Blog</title>
<meta name="keywords" content="" />
<meta name="description" content="This article is intended to be rather short ™. I will discuss my latest tool [https://github.com/adonese/ebs-live](ebs live dashboard api consumer). As the name suggests, this tool simply converts EBS&rsquo;s website into an API. Pretty simple right.
the problem  we have an html document we want to parse it to extract some text, v  We can use Go&rsquo;s excellent x/net/html library to parse the html. html package provides the following:">
<meta name="author" content="">
<link rel="canonical" href="/post/2020-04-03-simple-design/" />


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.6f60056d44d3f7eb69a4bc6c332b59960f3a995802bded244750232f33713c49.css" integrity="sha256-b2AFbUTT9&#43;tppLxsMytZlg86mVgCve0kR1AjLzNxPEk=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="mask-icon" href="safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.88.1" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Simple design: probably a good one!" />
<meta property="og:description" content="This article is intended to be rather short ™. I will discuss my latest tool [https://github.com/adonese/ebs-live](ebs live dashboard api consumer). As the name suggests, this tool simply converts EBS&rsquo;s website into an API. Pretty simple right.
the problem  we have an html document we want to parse it to extract some text, v  We can use Go&rsquo;s excellent x/net/html library to parse the html. html package provides the following:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/2020-04-03-simple-design/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-04-03T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2020-04-03T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Simple design: probably a good one!"/>
<meta name="twitter:description" content="This article is intended to be rather short ™. I will discuss my latest tool [https://github.com/adonese/ebs-live](ebs live dashboard api consumer). As the name suggests, this tool simply converts EBS&rsquo;s website into an API. Pretty simple right.
the problem  we have an html document we want to parse it to extract some text, v  We can use Go&rsquo;s excellent x/net/html library to parse the html. html package provides the following:"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Simple design: probably a good one!",
      "item": "/post/2020-04-03-simple-design/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Simple design: probably a good one!",
  "name": "Simple design: probably a good one!",
  "description": "This article is intended to be rather short ™. I will discuss my latest tool [https://github.com/adonese/ebs-live](ebs live dashboard api consumer). As the name suggests, this tool simply converts EBS\u0026rsquo;s website into an API. Pretty simple right.\nthe problem  we have an html document we want to parse it to extract some text, v  We can use Go\u0026rsquo;s excellent x/net/html library to parse the html. html package provides the following:",
  "keywords": [
    
  ],
  "articleBody": "This article is intended to be rather short ™. I will discuss my latest tool [https://github.com/adonese/ebs-live](ebs live dashboard api consumer). As the name suggests, this tool simply converts EBS’s website into an API. Pretty simple right.\nthe problem  we have an html document we want to parse it to extract some text, v  We can use Go’s excellent x/net/html library to parse the html. html package provides the following:\n proper utf-8 encoding html body node traversing (e.g., it does exactly what your browser do with manipulating and accessing the DOM)  The code for this part is really simple so, i won’t go into it at all.\nchallenges  ebs server is down. This is a problem in that we have to need a way for failure retrial, and we also don’t want to offload their server with unnecessary hits. having their server down is also problematic in that if we will fail whenever ebs fails, then what is the value proposition of what we’re offering here?  Caching for the win! Or storage. We need to store the value somewhere so we can retrieve it (if we failed to get results from EBS).\nkeep it simple, stupid The urge to use a database for this task is just isane. But, you really don’t need to do so!\n we can store it in a list we can store it in hashmap etc  Let’s model the problem we are fixing actually.\ntype store struct { time time.Time // time of retrieval  value int // value we want  isEmpty bool result []store //hmmm what is this thing? } As you can see, we have added result which is a list of type store. This is really neat feature as it will allow us to recursively add new store objects to the store object. Slices in go are pointers to arrays and as a result they can be passed around efficiently. We can append into this list from different state in our application.\nstore struct has other methods as well, namely:\n(*store).getEBS(url string) (*store).append(store) (*store).getLatest()store (*store).toJson(store)someJsonObject  They can be used to keep the code clean and let you to easily refactor and fix the code.\nchannels and caching ebs-live will use channels. Another awesome concept from go to achieve concurrency and communicate between different threads (or go routines). Every 1 minute, we check EBS endpoint and (*store).getEBS(url string) to ebs-live. This way we will only be hitting EBS servers one time per minute.\nCaching the result is the nice part, and it is where everything comes together. After we (*store).getEBS(url string) from ebs, we append these data:\ns.result = append(s.result, newData) This way, s.result will be updated with the latest result from ebs PLUS, we are also preserving the previous data.\nfailures Preserving data is vital here since ebs service (or this external service) in unreliable and we believe it will get down. Our users expect to find something when they hit our system, and it will be extremely awkward if we return an error.\nLet’s see how (*store).getLatest()store works.\nfunc (s *store)getLatest()store { for i := len(s.result); i--; i ==0 { if s.result[i].isEmpty { continue } return s.result[i] } // error handling is ommitted } So, starting backward, we traverse the []store and returns the first value with isEmpty is not true. This solves the problem of what happens when ebs server is down for us. Remember we have store.time field, which will be used in the response to notify the user when this data was retrieved.\nThere are plenty of nice things i enjoyed and learned a lot while doing this exercise, and I’d definitely recommend everyone to check out the code at: https://github.com/adonese/ebs-live and contribute to it.\nKeeping the design simple makes our programs maintainable and “nice” to work with. In this post we learned how to:\n use the standard library to make an in-memory storage use the standard library to parse html document use the standard library to do concurrency use the standard library to orchestrate all of that  Developers often forget how Computer Science topics in data structure are so powerful and can help a lot! Relying on other’s code is usually a bad trait and it should be discouraged. And data structures are really powerful topic and a huge area to explore and learn from!\n",
  "wordCount" : "715",
  "inLanguage": "en",
  "datePublished": "2020-04-03T00:00:00Z",
  "dateModified": "2020-04-03T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/2020-04-03-simple-design/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "adonese's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="" accesskey="h" title="adonese&#39;s Blog (Alt + H)">adonese&#39;s Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Simple design: probably a good one!
    </h1>
    <div class="post-meta"><span title='2020-04-03 00:00:00 +0000 UTC'>April 3, 2020</span>

</div>
  </header> 
  <div class="post-content"><p>This article is intended to be rather short ™. I will discuss my latest tool [https://github.com/adonese/ebs-live](ebs live dashboard api consumer). As the name suggests, this tool simply converts EBS&rsquo;s website into an API. Pretty simple right.</p>
<h2 id="the-problem">the problem<a hidden class="anchor" aria-hidden="true" href="#the-problem">#</a></h2>
<ul>
<li>we have an html document</li>
<li>we want to parse it</li>
<li>to extract some text, <code>v</code></li>
</ul>
<p>We can use Go&rsquo;s excellent x/net/html library to parse the html. <code>html</code> package provides the following:</p>
<ul>
<li>proper utf-8 encoding</li>
<li>html <code>body</code> node traversing (e.g., it does exactly what your browser do with manipulating and accessing the DOM)</li>
</ul>
<p>The code for this part is really simple so, i won&rsquo;t go into it at all.</p>
<h2 id="challenges">challenges<a hidden class="anchor" aria-hidden="true" href="#challenges">#</a></h2>
<ul>
<li>ebs server is down. This is a problem in that we have to need a way for failure retrial, and we also don&rsquo;t want to offload their server with unnecessary hits.</li>
<li>having their server down is also problematic in that if we will fail <em>whenever</em> ebs fails, then what is the value proposition of what we&rsquo;re offering here?</li>
</ul>
<p>Caching for the win! Or storage. We need to store the value somewhere so we can retrieve it (if we failed to get results from EBS).</p>
<h2 id="keep-it-simple-stupid">keep it simple, stupid<a hidden class="anchor" aria-hidden="true" href="#keep-it-simple-stupid">#</a></h2>
<p>The urge to use a database for this task is just isane. But, you really don&rsquo;t need to do so!</p>
<ul>
<li>we can store it in a list</li>
<li>we can store it in hashmap
etc</li>
</ul>
<p>Let&rsquo;s model the problem we are fixing actually.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">store</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">time</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span> <span style="color:#75715e">// time of retrieval
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">value</span> <span style="color:#66d9ef">int</span> <span style="color:#75715e">// value we want
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">isEmpty</span> <span style="color:#66d9ef">bool</span>
    <span style="color:#a6e22e">result</span> []<span style="color:#a6e22e">store</span> <span style="color:#75715e">//hmmm what is this thing?
</span><span style="color:#75715e"></span>}
</code></pre></div><p>As you can see, we have added <code>result</code> which is a list of type <code>store</code>. This is really neat feature as it will allow us to recursively add new <code>store</code> objects to the <code>store</code> object. Slices in go are pointers to arrays and as a result they can be passed around efficiently. We can append into this list from different state in our application.</p>
<p><code>store</code> struct has other methods as well, namely:</p>
<pre><code>(*store).getEBS(url string)

(*store).append(store)

(*store).getLatest()store

(*store).toJson(store)someJsonObject
</code></pre>
<p>They can be used to keep the code clean and let you to easily refactor and fix the code.</p>
<h2 id="channels-and-caching">channels and caching<a hidden class="anchor" aria-hidden="true" href="#channels-and-caching">#</a></h2>
<p>ebs-live will use channels. Another awesome concept from go to achieve concurrency and communicate between different threads (or go routines). Every 1 minute, we check EBS endpoint and <code>(*store).getEBS(url string)</code> to ebs-live. This way we will only be hitting EBS servers one time per minute.</p>
<p>Caching the result is the nice part, and it is where everything comes together. After we <code>(*store).getEBS(url string)</code> from ebs, we append these data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">result</span> = append(<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">result</span>, <span style="color:#a6e22e">newData</span>)
</code></pre></div><p>This way, s.result will be updated with the latest result from ebs PLUS, we are also preserving the previous data.</p>
<h3 id="failures">failures<a hidden class="anchor" aria-hidden="true" href="#failures">#</a></h3>
<p>Preserving data is vital here since ebs service (or this external service) in unreliable and we believe it will get down. Our users expect to find something when they hit our system, and it will be extremely awkward if we return an error.</p>
<p>Let&rsquo;s see how <code>(*store).getLatest()store</code> works.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">store</span>)<span style="color:#a6e22e">getLatest</span>()<span style="color:#a6e22e">store</span> {
    
    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> len(<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">result</span>); <span style="color:#a6e22e">i</span><span style="color:#f92672">--</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">==</span><span style="color:#ae81ff">0</span> {
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">result</span>[<span style="color:#a6e22e">i</span>].<span style="color:#a6e22e">isEmpty</span> {
            <span style="color:#66d9ef">continue</span>
        }
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">result</span>[<span style="color:#a6e22e">i</span>]
    }
    <span style="color:#75715e">// error handling is ommitted
</span><span style="color:#75715e"></span>}
</code></pre></div><p>So, starting backward, we traverse the []store and returns the first value with <code>isEmpty</code> is not true. This solves the problem of what happens when ebs server is down for us. Remember we have <code>store.time</code> field, which will be used in the response to notify the user when this data was retrieved.</p>
<p>There are plenty of nice things i enjoyed and learned a lot while doing this exercise, and I&rsquo;d definitely recommend everyone to check out the code at: <a href="https://github.com/adonese/ebs-live">https://github.com/adonese/ebs-live</a> and contribute to it.</p>
<p>Keeping the design simple makes our programs maintainable and &ldquo;nice&rdquo; to work with. In this post we learned how to:</p>
<ul>
<li>use the standard library to make an in-memory storage</li>
<li>use the standard library to parse html document</li>
<li>use the standard library to do concurrency</li>
<li>use the standard library to orchestrate all of that</li>
</ul>
<p>Developers often forget how Computer Science topics in data structure are so powerful and can help a lot! Relying on other&rsquo;s code is usually a bad trait and it should be discouraged. And data structures are really powerful topic and a huge area to explore and learn from!</p>


  </div>

  <footer class="post-footer">
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2021 <a href="">adonese&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
